## 保育園の新設場所検討

### 目的
保育園の新設場所として、既設の保育園の位置と子供の多いまたは増加傾向にある地域を比較し、子供が多いが既設の保育園が近くにない場所を選びたい。

### 使用する技術

* データのクレンジング
* コロプレスマップ（階数分布図）
* [QGIS](/vled-tech/tools/tools-qgis.md)を利用した地理空間情報の重ね合わせ

### 使用するデータ

* 保育園の位置情報または住所のリスト
* 街区ごとの人口統計
* 街区の境界GISデータ

### 実現手順

横浜市金沢区を例に、実現手順を述べる。

#### 1.データの取得
[横浜市金沢区のデータカタログサイト](http://www.city.yokohama.lg.jp/kanazawa/kz-opendata/kz-opendata.html) から、以下の4つのデータを取得する。

* 認可保育園
* 横浜保育室
* 認可外保育園
* 認定こども園

また、[e-stat](http://www.e-stat.go.jp/)から鈍行統計データを入手する。その手順は以下の通り。

1. 「地図や図表で見る」を選択
2. 「データダウンロード」を選択
3. Step1で「国勢調査」の「小地域」、Step2で「年齢別」を選択
4. Step3で「神奈川県」「横浜市金沢区」を、Step4で統計データと境界データをそれぞれダウンロード

![e-statトップページ](images/scenario-nursery/estat-top.png "図 e-statトップページ")   
図 e-statトップページ

![Step1](images/scenario-nursery/estat-step1.png "図 Step1")   
図 データ取得Step 1,2

![Step3](images/scenario-nursery/estat-step3.png "図 Step3")   
図 データ取得Step 3,4

#### 2. データのクレンジング・前処理
入手した人口統計データには、秘匿を示す「X」とデータがないことを示す「-」という文字値が含まれている。これらを数値データから除いておく。   
また、データの第1行目にある、区全体の行を削除する。これは、このあとコロプレスマップを作成する際に、値の境界値を適切にするためである。

この後、ファイルの拡張子を「txt」から「csv」に変更する。

![数値以外の値を除去](images/scenario-nursery/cleaning.png "図 数値以外の値を除去")   
図 数値以外の値を除去

また、各列のデータ形式（数値・文字列等）を示すファイルを作成し、このファイルの拡張子を「csvt」とする。

![データ形式ファイルの作成](images/scenario-nursery/datatype.png "図 データ形式ファイルの作成")   
図 データ形式ファイルの作成

#### 3. 背景地図の取り込み
今回は、OpenSteetMapを背景地図に利用する。OpenLayersプラグインをインストールし、メニューの「Web」→「OpenLayers Plugin」→「OpenStreetMap」の順に選択して取り込む。そのあと、表示を横浜市金沢区付近に合わせる。

![OpenStreemtMapの取り込み](images/scenario-nursery/qgis-kanazawa.png "図 OpenStreemtMapの取り込み")   
図 OpenStreemtMapの取り込み

#### 4. 人口データと境界データをドッキングし、コロプレスマップを作成
メニューの「レイヤ」→「プロパティ」→「結合」を選択し、ダウンロードした境界データのshapefileと、2.で編集したCSVデータをQGISウィンドウに投げ込み、ベクタ統合する。   
この両者は、KEY_CODEフィールドを利用して結合できる。

結合完了後、レイヤプロパティの「スタイル」を選択し、5歳未満の人口を示す「T000573001」カラムを選択する。色階調を調整して適用すると、OpenStreetMap上にコロプレスマップを合成できる。

![コロプレスマップの合成](images/scenario-nursery/qgis-choroplethmap.png "図 コロプレスマップの合成")   
図 コロプレスマップの合成

#### 5. 保育園の位置を重ね合わせ
メニューの「レイヤ」→「レイヤの追加」→「デリミテッドテキストレイヤの追加」を選択する。   
2.でクレンジング・前処理したCSVファイルを選択し、Xフィールドを「経度」、Yフィールドを「緯度」に設定する。続いて、空間参照システムを選択する画面に遷移する。今回はJGD2000を選択した。

![認可保育園の位置を追加](images/scenario-nursery/delimitedText.png "図 認可保育園の位置の追加")   
図 認可保育園の位置の追加

追加した結果は、下図のようになる。

![認可保育園の位置を追加結果](images/scenario-nursery/qgis-addNursery.png "図 認可保育園の位置の追加結果")   
図 認可保育園の位置の追加結果

同様に、他の保育施設の位置も追加すると、下図のようになる。矢印を施した街区は5歳未満の児童が多いが周囲に保育施設が少ないことがわかる。

![保育施設の位置の追加結果](images/scenario-nursery/result.png "図 保育施設の位置の追加結果")   
図 保育施設の位置の追加結果




